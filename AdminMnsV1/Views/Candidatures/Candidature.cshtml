@using AdminMnsV1.Models;
@using AdminMnsV1.Models.ViewModels;
@using AdminMnsV1.Models.CandidaturesModels;
@model AdminMnsV1.Models.ViewModels.CandidaturesOverviewViewModel



@{
	ViewData["Title"] = "Dossiers";
}

<h1 class="mx-4 mt-5">Dossiers</h1>

<div class="graphs">
	<div class="graphFileClass m-4 border rounded-4 bg-light">
		<div class="title">
			<h2 class="mt-5 mx-4 text-center">Visualisation des dossiers</h2>
		</div>
		<div class="barFile w-75 mx-auto">
			<canvas id="fileClass" aria-label="chart" role="img"></canvas>
		</div>
	</div>
</div>



<div class="btnNewDossier">
	<button type="button" class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#newDossierModal">
		<img width="20" height="20" src="https://img.icons8.com/ios/50/plus--v1.png" alt="plus--v1" /> Nouveau Dossier
	</button>
</div>


<div class="modal fade" id="newDossierModal" tabindex="-1" aria-labelledby="newDossierModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="newDossierModalLabel">Créer un Nouveau Dossier de Candidature</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<form id="createDossierForm" method="post" asp-controller="Candidatures" asp-action="CreateCandidature">
				@Html.AntiForgeryToken()
				<div class="modal-body">
					<div asp-validation-summary="ModelOnly" class="text-danger"></div>

					<div class="mb-3">
						<label for="studentLastName" class="form-label">Nom du Candidat</label>
						<input type="text" class="form-control" id="studentLastName" asp-for="LastName" required>
						<span asp-validation-for="LastName" class="text-danger"></span>
					</div>
					<div class="mb-3">
						<label for="studentFirstName" class="form-label">Prénom du Candidat</label>
						<input type="text" class="form-control" id="studentFirstName" asp-for="FirstName" required>
						<span asp-validation-for="FirstName" class="text-danger"></span>
					</div>
					<div class="mb-3">
						<label for="studentEmail" class="form-label">Email du Candidat</label>
						<input type="email" class="form-control" id="studentEmail" asp-for="Email" required>
						<span asp-validation-for="Email" class="text-danger"></span>
					</div>
					<div class="mb-3">
						<label for="studentPhoneNumber" class="form-label">Téléphone du Candidat</label>
						<input type="tel" class="form-control" id="studentPhoneNumber" asp-for="Phone">
						<span asp-validation-for="Phone" class="text-danger"></span>
					</div>
					<div class="mb-3">
						<label for="studentBirthDate" class="form-label">Date de naissance</label>
						<input type="date" class="form-control" id="studentBirthDate" asp-for="BirthDate">
						<span asp-validation-for="BirthDate" class="text-danger"></span>
					</div>
					<div class="mb-3">
						<label for="statut" class="form-label">Statut</label>
						<input type="text" class="form-control" id="statut" asp-for="Statut">
						<span asp-validation-for="Statut" class="text-danger"></span>
					</div>
					<div class="mb-3">
						<label for="classId" class="form-label">Sélectionner la Classe</label>
						<select class="form-select" id="classId" asp-for="ClassId"
								asp-items="Model.AvailableClasses">
							<option value="">Sélectionner une classe</option>
						</select>
						<span asp-validation-for="ClassId" class="text-danger"></span>
					</div>

					<div class="mb-3">
						<label class="form-label">Documents requis pour ce dossier :</label>
						<div id="documentTypesCheckboxes" class="border d-flex justify-content-center flex-wrap p-3 rounded">
							@if (Model.AllAvailableDocumentTypes != null && Model.AllAvailableDocumentTypes.Any())
							{
								foreach (var docType in Model.AllAvailableDocumentTypes)
								{
									<div class="form-check">
										<input class="form-check-input" type="checkbox"
											   value="@docType.DocumentTypeId"
											   id="docType_@docType.DocumentTypeId"
											   name="RequiredDocumentTypeIds"
										@(Model.RequiredDocumentTypeIds != null && Model.RequiredDocumentTypeIds.Contains(docType.DocumentTypeId) ? "checked" : "")>
										<label class="form-check-label" for="docType_@docType.DocumentTypeId">
											@docType.NameDocumentType
										</label>
									</div>
								}
							}
							else
							{
								<p class="text-muted">Aucun type de document disponible.</p>
							}
						</div>
					</div>

				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
					<button type="submit" class="btn btn-primary">Créer le Dossier et Envoyer l'Email</button>
				</div>
			</form>
		</div>
	</div>
</div>


    @* ACCORDEON DOSSIERS *@

<div class="accordion" id="accordionPanelsStayOpenExample">
    <div class="accordion-item">
        <h2 class="accordion-header" id="panelsStayOpen-headingOne">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true" aria-controls="panelsStayOpen-collapseOne">
                Dossiers En Cours
            </button>
        </h2>
        <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show" aria-labelledby="panelsStayOpen-headingOne">
            <div class="accordion-body">
                <div class="tableProfessors">
                    <table class="table align-middle table-striped table-hover table-custom bg-secondary table-responsive">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Nom</th>
                                <th scope="col">Prénom</th>
                                <th scope="col" class="d-none d-sm-table-cell">Classe</th>
                                <th scope="col" class="d-none d-md-table-cell">Date de Création</th>
                                <th scope="col">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model.CandidaturesEnCours != null && Model.CandidaturesEnCours.Any())
                            {
                                @foreach (var candidature in Model.CandidaturesEnCours)
                                {
                                    <tr>
                                        <th scope="row">@candidature.CandidatureId</th>
                                        <td>@candidature.User?.LastName</td>    @* Affiche le nom de famille de l'utilisateur lié *@
                                        <td>@candidature.User?.FirstName</td>    @* Affiche le prénom de l'utilisateur lié *@
                                        <td class="d-none d-sm-table-cell">@candidature.Class?.NameClass</td> @* Affiche le nom de la classe liée *@
                                        <td class="d-none d-md-table-cell">@candidature.CandidatureCreationDate?.ToString("yyyy-MM-dd")</td>
                                        <td>
                                            <button class="btn btn-primary">
                                                <a href="@Url.Action("CandidatureStudent", "CandidaturesStudents", new { id = candidature.CandidatureId })">Voir</a>
                                            </button>
                                        </td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="6" class="text-center">Aucun dossier en cours trouvé.</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="accordion-item">
        <h2 class="accordion-header" id="panelsStayOpen-headingTwo">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="false" aria-controls="panelsStayOpen-collapseTwo">
                Dossiers Validés
            </button>
        </h2>
        <div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingTwo">
            <div class="accordion-body">
                <div class="tableProfessors">
                    <table class="table align-middle table-striped table-hover table-custom bg-secondary table-responsive">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Nom</th>
                                <th scope="col">Prénom</th>
                                <th scope="col" class="d-none d-sm-table-cell">Classe</th>
                                <th scope="col" class="d-none d-md-table-cell">Date de Création</th>
                                <th scope="col">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model.CandidaturesValidees != null && Model.CandidaturesValidees.Any())
                            {
                                @foreach (var candidature in Model.CandidaturesValidees)
                                {
                                    <tr>
                                        <th scope="row">@candidature.CandidatureId</th>
                                        <td>@candidature.User?.LastName</td>
                                        <td>@candidature.User?.FirstName</td>
                                        <td class="d-none d-sm-table-cell">@candidature.Class?.NameClass</td>
                                        <td class="d-none d-md-table-cell">@candidature.CandidatureCreationDate?.ToString("yyyy-MM-dd")</td>
                                        <td>
                                            <button class="btn btn-primary">
                                                <a href="@Url.Action("Details", "Candidatures", new { id = candidature.CandidatureId })">Voir</a>
                                            </button>
                                        </td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="6" class="text-center">Aucun dossier validé trouvé.</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="accordion-item">
        <h2 class="accordion-header" id="panelsStayOpen-headingThree">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseThree" aria-expanded="false" aria-controls="panelsStayOpen-collapseThree">
                Dossiers Refusés
            </button>
        </h2>
        <div id="panelsStayOpen-collapseThree" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingThree">
            <div class="accordion-body">
                <div class="tableProfessors">
                    <table class="table align-middle table-striped table-hover table-custom bg-secondary table-responsive">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Nom</th>
                                <th scope="col">Prénom</th>
                                <th scope="col" class="d-none d-sm-table-cell">Classe</th>
                                <th scope="col" class="d-none d-md-table-cell">Date de Création</th>
                                <th scope="col">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model.CandidaturesRefusees != null && Model.CandidaturesRefusees.Any())
                            {
                                @foreach (var candidature in Model.CandidaturesRefusees)
                                {
                                    <tr>
                                        <th scope="row">@candidature.CandidatureId</th>
                                        <td>@candidature.User?.LastName</td>
                                        <td>@candidature.User?.FirstName</td>
                                        <td class="d-none d-sm-table-cell">@candidature.Class?.NameClass</td>
                                        <td class="d-none d-md-table-cell">@candidature.CandidatureCreationDate?.ToString("yyyy-MM-dd")</td>
                                        <td>
                                            <button class="btn btn-primary">
                                                <a href="@Url.Action("Details", "Candidatures", new { id = candidature.CandidatureId })">Voir</a>
                                            </button>
                                        </td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="6" class="text-center">Aucun dossier refusé trouvé.</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script id="chart-data" type="application/json">
    @Html.Raw(Json.Serialize(Model.ClassStats))
</script>


@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="~/js/styleGraphCandidature.js"></script>
}

@Html.Partial("~/Views/Shared/Components/_Footer.cshtml")