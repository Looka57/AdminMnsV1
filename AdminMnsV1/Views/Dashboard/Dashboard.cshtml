@* En haut de votre fichier Views/Dashboard/Dashboard.cshtml *@
@model AdminMnsV1.ViewModels.DashboardViewModel

@using AdminMnsV1.Models @* Utile si CardModel est défini dans Models *@

@{
	ViewData["Title"] = "Tableau de Bord Admin"; // Utilisez le ViewData défini dans le contrôleur
}

<h1 class="mx-4 mt-5">Bienvenue @Model.LoggedInUser.FirstName @Model.LoggedInUser.LastName !</h1>
<div class="cardBox">

	<!-- =====================CARDS DASHBORARD=============================== -->
	@foreach (var card in Model.Cards)
	{
		<div class="">
			<a href="@card.Url" class="card-link">
				<div class="cards border-0">
					<div>
						<div class="cardNumber">@card.Number</div>
						<div class="cardName">@card.Title</div>
					</div>
					<div class="iconCard">
						<img width="60" height="60" src="@card.IconUrl" alt="@card.AltText" />
					</div>
				</div>
			</a>
		</div>
	}
</div>


<!-- =======================GRAPHIQUES STAGIAIRE + ABS RETARD================ -->

<div class="graphs ">
	<div class="graphStagiaires bg-light border rounded-4  ">
		<div class="title">
			<h4>Total de Stagiaires</h4>
		</div>
		<div class="chartContainerStagiaire w-100">
			<canvas class="" id="stagiaireChart" aria-label="chart" role="img"></canvas>
		</div>
	</div>

	<div class="graphLateAbs bg-light border rounded-4  ">
		<div class="title">
			<h4>Total de Retards-Absences</h4>
		</div>
		<div class="chartContainerAbs w-100">
			<canvas id="absencesChart" aria-label="chart" role="img"></canvas>
		</div>
	</div>
</div>

<!-- =======================GRAPHIQUE + TABLEAU DOSSIERS================ -->
<!-- graphique -->
<div class="graphTableFiles">
	<div data-aos="fade-right">
		<div class="graphFiles me-5 border rounded-4  bg-light">
			<div class="title">
				<h4>Dossiers par classe</h4>
			</div>
			<div class="chartContainerDossier w-100">
				<canvas id="polarChart" aria-label="chart" role="img"></canvas>
			</div>
		</div>
	</div>

	<!-- tableau -->
	<div data-aos="fade-left">
		<div class="TableDossier pe-3 border rounded-4   bg-light ">
			<div class="title">
				<h4>Dossiers en cours</h4>
			</div>
			<div class="table-responsive border">
				<table class="table align-middle table-striped table-hover table-custom bg-secondary">
					<thead>
						<tr class="text-center">
							<th scope="col"></th>
							<th scope="col">Nom</th>
							<th scope="col" class="d-none d-md-table-cell">Prénom</th>
							<!-- Caché sur mobile -->
							<th scope="col">Action</th>
						</tr>
					</thead>
					<tbody>
						@if (Model.LatestViewedCandidatures != null && Model.LatestViewedCandidatures.Any())
						{
							@foreach (var candidature in Model.LatestViewedCandidatures)
							{
								<tr class="text-center">
									<th scope="row">
										<img width="14" height="14"
											 src="https://img.icons8.com/material-two-tone/24/collect.png"
											 alt="collect" />
									</th>
									<td>@candidature.User.LastName</td>
									<td class="d-none d-md-table-cell">@candidature.User.FirstName</td>
									<td>
										@{
											string buttonClass = "btn-outline-primary"; // Par défaut pour "En cours"
											if (candidature.CandidatureStatus?.Label?.Equals("Validé", StringComparison.OrdinalIgnoreCase) == true)
											{
												buttonClass = "btn-outline-success";
											}
											else if (candidature.CandidatureStatus?.Label?.Equals("Refusé", StringComparison.OrdinalIgnoreCase) == true ||
											candidature.CandidatureStatus?.Label?.Equals("Supprimé", StringComparison.OrdinalIgnoreCase) == true ||
											candidature.CandidatureStatus?.Label?.Equals("Invalidé", StringComparison.OrdinalIgnoreCase) == true)
											{
												buttonClass = "btn-outline-danger";
											}
										}
										<a asp-action="CandidatureStudent"
										   asp-controller="CandidaturesStudents"
										   asp-route-id="@candidature.CandidatureId"
										   class="btn btn-sm @buttonClass text-nowrap">
											@candidature.CandidatureStatus?.Label
										</a>
									</td>
								</tr>
							}
						}
						else
						{
							<tr class="text-center">
								<td colspan="4">Aucun dossier consulté récemment.</td>
							</tr>
						}
					</tbody>
				</table>
			</div>
		</div>

	</div>
</div>


<script>

		window.nombreHommes = @Model.NumberOfMen;
		window.nombreFemmes = @Model.NumberOfWomen;

		// POUR LE DÉBOGAGE : Vérifiez les valeurs dans la console
		// Correction du texte pour ne plus mentionner "ViewBag"
		console.log('Valeur de nombreHommes (définie par le ViewModel):', window.nombreHommes);
		console.log('Valeur de nombreFemmes (définie par le ViewModel):', window.nombreFemmes);

		// Dispatche UN SEUL événement personnalisé EN PASSANT les données via 'detail'
		document.dispatchEvent(new CustomEvent('stagiaireDataReady', {
			detail: {
				hommes: window.nombreHommes,
				femmes: window.nombreFemmes
			}
		})); // NOUVEAU : Correction des parenthèses et accolades manquantes
</script>
<script src="~/js/styleGraphStudentDonuts.js"></script>

<!-- =======================FOOTER================ -->
@Html.Partial("~/Views/Shared/Components/_Footer.cshtml")


